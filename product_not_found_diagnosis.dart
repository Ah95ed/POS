#!/usr/bin/env dart

/// ุฃุฏุงุฉ ุชุดุฎูุต ูุญุฏุฏุฉ ููุดููุฉ "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ"
/// ุชุญูู ุงููุดููุฉ ุจุงูุชูุตูู ูุชูุฏู ุญููู ูุงุถุญุฉ

void main() async {
  print('๐ ุชุดุฎูุต ูุดููุฉ "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ" ุนูุฏ ุงูุฏูุน\n');

  final diagnoser = ProductNotFoundDiagnoser();
  await diagnoser.diagnose();
}

class ProductNotFoundDiagnoser {
  Future<void> diagnose() async {
    print('๐ฏ ุชุญููู ูุดููุฉ "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ"...\n');

    _analyzeCodeFlow();
    _identifyPossibleCauses();
    _provideStepByStepSolution();
    _showTestingSteps();
  }

  /// ุชุญููู ุชุฏูู ุงูููุฏ
  void _analyzeCodeFlow() {
    print('๐ ุชุญููู ุชุฏูู ุงูููุฏ:');
    print('=' * 50);

    print('1. ุงููุณุชุฎุฏู ูุถุบุท ุนูู ุฒุฑ "ุฏูุน"');
    print('2. ูุชู ุงุณุชุฏุนุงุก SaleProvider.completeSale()');
    print('3. ูุชู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (_validateStock)');
    print('4. ูุชู ุฅูุดุงุก SaleModel ูุน ุชูุงุตูู ุงูููุชุฌุงุช');
    print('5. ูุชู ุงุณุชุฏุนุงุก SaleRepository.saveSale(saleModel)');
    print('6. โ ููุง ุชุญุฏุซ ุงููุดููุฉ ูู ุงูุณุทุฑ:');
    print('   ```');
    print('   final productQuantityResult = await txn.rawQuery(');
    print('     \'SELECT id, quantity, name FROM Items WHERE code = ?\',');
    print('     [item.productCode],');
    print('   );');
    print('   ```');
    print('7. ุฅุฐุง ูุงู productQuantityResult.isEmptyุ ุชุธูุฑ ุฑุณุงูุฉ:');
    print(
      '   "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช: [ุงุณู ุงูููุชุฌ] (ููุฏ: [ููุฏ ุงูููุชุฌ])"',
    );
    print('');
  }

  /// ุชุญุฏูุฏ ุงูุฃุณุจุงุจ ุงููุญุชููุฉ
  void _identifyPossibleCauses() {
    print('๐ ุงูุฃุณุจุงุจ ุงููุญุชููุฉ ูููุดููุฉ:');
    print('=' * 50);

    print('ุงูุณุจุจ ุงูุฃูุซุฑ ุดููุนุงู (70%):');
    print('โ ููุฏ ุงูููุชุฌ ูู ุงููุงุชูุฑุฉ ูุง ูุทุงุจู ููุฏ ุงูููุชุฌ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช');
    print(
      '  - ูุซุงู: ุงููุงุชูุฑุฉ ุชุญุชูู ุนูู "PROD001" ููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญุชูู ุนูู "prod001"',
    );
    print('  - ุฃู: ุงูููุฏ ูุญุชูู ุนูู ูุณุงูุงุช ุฅุถุงููุฉ');
    print('');

    print('ุงูุณุจุจ ุงูุซุงูู (20%):');
    print('โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงุฑุบุฉ ูู ุงูููุชุฌุงุช ุฃู ุงูููุชุฌ ูุญุฐูู');
    print('  - ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุฌุฏูู Items');
    print('  - ุงูููุชุฌ ูุงู ููุฌูุฏ ููู ุชู ุญุฐูู');
    print('');

    print('ุงูุณุจุจ ุงูุซุงูุซ (10%):');
    print('โ ูุดููุฉ ูู ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃู ุงูุงุชุตุงู');
    print('  - ุฌุฏูู Items ุบูุฑ ููุฌูุฏ');
    print('  - ุงูุนููุฏ code ุบูุฑ ููุฌูุฏ');
    print('  - ุฎุทุฃ ูู SQL Query');
    print('');
  }

  /// ุชูุฏูู ุญู ุฎุทูุฉ ุจุฎุทูุฉ
  void _provideStepByStepSolution() {
    print('๐๏ธ ุงูุญู ุฎุทูุฉ ุจุฎุทูุฉ:');
    print('=' * 50);

    print('ุงูุฎุทูุฉ 1: ุชุดุฎูุต ุฃููู');
    print('โก ุงูุชุญ ุงูุชุทุจูู');
    print('โก ุงุฐูุจ ุฅูู ุดุงุดุฉ "ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช"');
    print('โก ุชุญูู ูู ูุฌูุฏ ููุชุฌุงุช ูู ุงููุงุฆูุฉ');
    print('');

    print('ุฅุฐุง ูู ุชูุฌุฏ ููุชุฌุงุช:');
    print('โ ุฃุถู ููุชุฌ ุชุฌุฑูุจู:');
    print('  - ุงูุงุณู: "ููุชุฌ ุชุฌุฑูุจู"');
    print('  - ุงูููุฏ: "TEST001" (ุจุฃุญุฑู ูุจูุฑุฉ)');
    print('  - ุงูุณุนุฑ: 10.00');
    print('  - ุงููููุฉ: 50');
    print('โก ุงุญูุธ ุงูููุชุฌ');
    print('โก ุงูุชูู ูุดุงุดุฉ ุงููุจูุนุงุช');
    print('โก ุฃุฏุฎู ุงูููุฏ "TEST001" ุจุงูุถุจุท');
    print('โก ุฌุฑุจ ุฅุชูุงู ุงูุจูุน');
    print('');

    print('ุฅุฐุง ูุฌุฏุช ููุชุฌุงุช:');
    print('โ ุงุฎุชุฑ ููุชุฌ ูู ุงููุงุฆูุฉ');
    print('โ ุงูุณุฎ ุงูููุฏ ุงูุฎุงุต ุจู ุจุงูุถุจุท');
    print('โ ุงูุชูู ูุดุงุดุฉ ุงููุจูุนุงุช');
    print('โ ุงูุตู ุงูููุฏ ูู ุญูู ุงูุจุญุซ');
    print('โ ุฌุฑุจ ุฅุชูุงู ุงูุจูุน');
    print('');

    print('ุงูุฎุทูุฉ 2: ุญู ูุดููุฉ ุชุทุงุจู ุงูุฃููุงุฏ');
    print('โก ุชุฃูุฏ ูู ุฃู ุงูููุฏ ูุง ูุญุชูู ุนูู ูุณุงูุงุช ูู ุงูุจุฏุงูุฉ ุฃู ุงูููุงูุฉ');
    print('โก ุชุฃูุฏ ูู ุฃู ุญุงูุฉ ุงูุฃุญุฑู ูุชุทุงุจูุฉ (ูุจูุฑุฉ/ุตุบูุฑุฉ)');
    print('โก ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุญุฑู ุฎุงุตุฉ ุบูุฑ ูุชููุนุฉ');
    print('');

    print('ุงูุฎุทูุฉ 3: ุฅุตูุงุญ ุงููุธุงู (ุฅุฐุง ูู ุชูุฌุญ ุงูุฎุทูุงุช ุงูุณุงุจูุฉ)');
    print('โก ููุฐ ุงูุฃูุฑ: dart fix_inventory_system.dart');
    print('โก ุฃู ุฃุถู ุจูุงูุงุช ุชุฌุฑูุจูุฉ: dart setup_sample_data.dart');
    print('โก ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู');
    print('');
  }

  /// ุนุฑุถ ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ
  void _showTestingSteps() {
    print('๐งช ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงูููุงุฆู:');
    print('=' * 50);

    print('ุงุฎุชุจุงุฑ ุฃุณุงุณู:');
    print('1. ุฃุถู ููุชุฌ ุฌุฏูุฏ ุจููุฏ "SIMPLE001"');
    print('2. ูู ุดุงุดุฉ ุงููุจูุนุงุชุ ุฃุฏุฎู "SIMPLE001" ุจุงูุถุจุท');
    print('3. ุชุฃูุฏ ูู ุฅุถุงูุฉ ุงูููุชุฌ ูููุงุชูุฑุฉ');
    print('4. ุฃุฏุฎู ูุจูุบ ุฃูุจุฑ ูู ุงูุฅุฌูุงูู ููุจูุบ ูุฏููุน');
    print('5. ุงุถุบุท ุนูู "ุฏูุน"');
    print('6. ูุฌุจ ุฃู ุชุชู ุงูุนูููุฉ ุจูุฌุงุญ');
    print('');

    print('ุงุฎุชุจุงุฑ ูุชูุฏู:');
    print('1. ุฃุถู ุนุฏุฉ ููุชุฌุงุช ูููุงุชูุฑุฉ');
    print('2. ุชุฃูุฏ ูู ุฃู ูู ููุชุฌ ูู ููุฏ ุตุญูุญ');
    print('3. ุชุญูู ูู ููุงูุฉ ุงููููุงุช ูู ุงููุฎุฒูู');
    print('4. ุฌุฑุจ ุฅุชูุงู ุงูุจูุน');
    print('');

    print('๐ง ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:');
    print('โ' * 30);

    print('ุฑุณุงุฆู ุงูุฎุทุฃ ูุญููููุง:');
    print('');

    print('ุฑุณุงูุฉ: "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช: [ุงุณู] (ููุฏ: [ููุฏ])"');
    print('โ ุงูุญู: ุชุญูู ูู ุตุญุฉ ุงูููุฏ ุฃู ุฃุถู ุงูููุชุฌ ูุฑุฉ ุฃุฎุฑู');
    print('');

    print('ุฑุณุงูุฉ: "ุงููููุฉ ุงููุทููุจุฉ ุฃูุจุฑ ูู ุงููุชุงุญ"');
    print('โ ุงูุญู: ููู ุงููููุฉ ุฃู ุฃุถู ูุฎุฒูู ููููุชุฌ');
    print('');

    print('ุฑุณุงูุฉ: "ุฎุทุฃ ูู ุญูุธ ุงููุงุชูุฑุฉ"');
    print('โ ุงูุญู: ุชุญูู ูู ุตุญุฉ ุจูุงูุงุช ุงููุงุชูุฑุฉ ุฃู ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู');
    print('');

    print('๐ ูููุณุงุนุฏุฉ ุงูุทุงุฑุฆุฉ:');
    print('โ' * 20);
    print('1. ุฃูุดุฆ ููุชุฌ ุฌุฏูุฏ ุจุงูููุงุตูุงุช ุงูุชุงููุฉ:');
    print('   ุงูุงุณู: ุงุฎุชุจุงุฑ ุงููุธุงู');
    print('   ุงูููุฏ: EMERGENCY001');
    print('   ุงูุณุนุฑ: 1.00');
    print('   ุงููููุฉ: 999');
    print('');
    print('2. ุงุณุชุฎุฏู ูุฐุง ุงูููุชุฌ ููุท ูู ุงูุจูุน');
    print('3. ุฅุฐุง ูุฌุญุ ูุงููุดููุฉ ูู ุจูุงูุงุช ุงูููุชุฌุงุช ุงูุฃุฎุฑู');
    print('4. ุฅุฐุง ูุดูุ ูุงููุดููุฉ ูู ุงููุธุงู ููุณู');
    print('');

    print('๐ ูุตุงุฆุญ ุฅุถุงููุฉ:');
    print('โข ุงุญูุธ ุฃููุงุฏ ุงูููุชุฌุงุช ูู ููู ูุตู ููุฑุฌูุน ุฅูููุง');
    print('โข ุงุณุชุฎุฏู ุฃููุงุฏ ุจุณูุทุฉ ูุซู: ITEM001, ITEM002, ุฅูุฎ');
    print('โข ุชุฌูุจ ุงูุฃุญุฑู ุงูุฎุงุตุฉ ูุงููุณุงูุงุช ูู ุงูุฃููุงุฏ');
    print('โข ุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ ุจุนูุงูุฉ - ุชุญุชูู ุนูู ูุนูููุงุช ูููุฏุฉ');
    print('โข ุงุฎุชุจุฑ ุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ ููุฑ ุฅุถุงูุชูุง');

    print('');
    print(
      '๐ฏ ุงููุฏู: ุงูุชุฃูุฏ ูู ุชุทุงุจู ููุฏ ุงูููุชุฌ ุงูููุฏุฎู ูุน ุงููุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช',
    );
    print('');
    print(
      'โ ุจุนุฏ ุชุทุจูู ูุฐู ุงูุฎุทูุงุชุ ูุฌุจ ุฃู ุชุฎุชูู ูุดููุฉ "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ" ููุงุฆูุงู!',
    );
  }
}
