# نظام نقطة البيع - Point of Sale System

## 🛒 نظرة عامة
تم إنشاء نظام نقطة بيع متكامل وشامل مع جميع المميزات المطلوبة لإدارة عمليات البيع بكفاءة عالية.

## 🏗️ الهيكل المعماري

### 📊 طبقة النماذج (Models)
```
lib/Model/SaleModel.dart
├── SaleItem class          # عنصر في الفاتورة
├── Sale class              # الفاتورة الكاملة
├── SaleStatus enum         # حالة الفاتورة
├── PaymentMethod enum      # طرق الدفع
├── SaleCalculation class   # حسابات الفاتورة
└── SalesStats class        # إحصائيات المبيعات
```

### 🔄 طبقة المستودع (Repository)
```
lib/Repository/SaleRepository.dart
├── إنشاء جداول المبيعات
├── حفظ واسترجاع الفواتير
├── البحث والفلترة
├── الإحصائيات والتقارير
└── إدارة المخزون
```

### 🎯 طبقة التحكم (Controller)
```
lib/Controller/SaleProvider.dart
├── إدارة الفاتورة الحالية
├── حسابات الأسعار والضرائب
├── إدارة طرق الدفع
├── التفاعل مع المخزون
└── معالجة الأخطاء
```

### 🎨 طبقة العرض (Views)
```
lib/View/
├── Screens/
│   └── SalesScreen.dart           # الشاشة الرئيسية
└── Widgets/
    ├── SaleItemCard.dart          # بطاقة عنصر البيع
    ├── ProductSelectionDialog.dart # نافذة اختيار المنتجات
    └── PaymentDialog.dart         # نافذة الدفع
```

## ✨ المميزات الرئيسية

### 🛍️ إدارة الفاتورة
- **إضافة المنتجات** بالبحث أو الباركود
- **تعديل الكميات** بسهولة
- **تطبيق خصومات** على المنتجات أو الفاتورة
- **حساب الضرائب** تلقائياً
- **إزالة المنتجات** من الفاتورة

### 💳 طرق الدفع المتعددة
- **نقدي** 💵 - مع حساب الباقي
- **بطاقة ائتمان** 💳 - دفع إلكتروني
- **تحويل بنكي** 🏦 - للمبالغ الكبيرة
- **محفظة إلكترونية** 📱 - الدفع الرقمي

### 🔍 البحث والاختيار
- **البحث السريع** في المنتجات
- **مسح الباركود** للإضافة السريعة
- **شبكة المنتجات** التفاعلية
- **فلترة حسب التوفر** والحالة

### 📊 الحسابات المتقدمة
- **المجموع الفرعي** للمنتجات
- **الخصومات** الفردية والعامة
- **الضرائب** بنسب قابلة للتعديل
- **الإجمالي النهائي** مع جميع الحسابات

### 👥 إدارة العملاء
- **معلومات العميل** الاختيارية
- **رقم الهاتف** للمتابعة
- **تاريخ المشتريات** لكل عميل

## 🎨 واجهة المستخدم

### 📱 التصميم المتجاوب
- **الشاشات الكبيرة (> 800px):**
  - تخطيط جانبي مع المنتجات على اليسار والفاتورة على اليمين
  - شبكة منتجات متعددة الأعمدة
  - عرض مفصل للمعلومات

- **الشاشات الصغيرة (≤ 800px):**
  - تخطيط عمودي مع التركيز على الفاتورة
  - شريط بحث وباركود في الأعلى
  - أزرار كبيرة سهلة اللمس

### 🎯 العناصر التفاعلية
- **بطاقات المنتجات** قابلة للنقر
- **عناصر التحكم في الكمية** سهلة الاستخدام
- **أزرار الخصم** لكل منتج
- **ملخص فوري** للحسابات

### 🎨 التصميم البصري
- **ألوان متناسقة** مع اللون الأخضر الأساسي
- **أيقونات واضحة** لكل عملية
- **تدرجات لونية** جميلة
- **ظلال وحدود** أنيقة

## 🔧 العمليات المتاحة

### إضافة منتج للفاتورة
```dart
// بالبحث والاختيار
await saleProvider.addProductToSale(product, quantity: 2);

// بالكود أو الباركود
await saleProvider.addProductByCode('P001', quantity: 1);
```

### تطبيق خصم
```dart
// خصم على منتج محدد
saleProvider.applyItemDiscount(itemIndex, 10.0);

// خصم عام على الفاتورة
saleProvider.applyGeneralDiscount(50.0);
```

### إتمام البيع
```dart
// تحديث معلومات الدفع
saleProvider.updatePaymentMethod('نقدي');
saleProvider.updatePaidAmount(150.0);
saleProvider.updateCustomerInfo(name: 'أحمد محمد', phone: '0501234567');

// إتمام البيع
final success = await saleProvider.completeSale();
```

## 📋 جداول قاعدة البيانات

### جدول المبيعات (sales)
```sql
CREATE TABLE sales (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  invoice_number TEXT UNIQUE NOT NULL,
  date TEXT NOT NULL,
  subtotal REAL NOT NULL,
  discount REAL DEFAULT 0.0,
  tax REAL DEFAULT 0.0,
  total REAL NOT NULL,
  payment_method TEXT NOT NULL,
  paid_amount REAL NOT NULL,
  change_amount REAL DEFAULT 0.0,
  customer_name TEXT,
  customer_phone TEXT,
  notes TEXT,
  status TEXT DEFAULT 'completed',
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

### جدول عناصر المبيعات (sale_items)
```sql
CREATE TABLE sale_items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  sale_id INTEGER NOT NULL,
  product_code TEXT NOT NULL,
  product_name TEXT NOT NULL,
  unit_price REAL NOT NULL,
  quantity INTEGER NOT NULL,
  discount REAL DEFAULT 0.0,
  total REAL NOT NULL,
  FOREIGN KEY (sale_id) REFERENCES sales (id) ON DELETE CASCADE
);
```

## 🔍 البحث والفلترة

### البحث في المنتجات
- **بالاسم:** بحث جزئي غير حساس لحالة الأحرف
- **بالكود:** بحث دقيق للوصول السريع
- **بالشركة:** فلترة حسب الشركة المصنعة

### فلترة المنتجات
- **المتوفرة فقط:** إخفاء المنتجات نافدة المخزون
- **حسب الفئة:** تصنيف المنتجات (قابل للتوسع)
- **حسب السعر:** نطاقات سعرية محددة

## 💰 نظام الحسابات

### حساب الإجماليات
```dart
// المجموع الفرعي
double subtotal = items.fold(0.0, (sum, item) => sum + item.calculateTotal());

// بعد الخصم العام
double afterDiscount = subtotal - generalDiscount;

// الضريبة
double taxAmount = afterDiscount * (taxRate / 100);

// الإجمالي النهائي
double total = afterDiscount + taxAmount;
```

### أنواع الخصومات
- **خصم المنتج:** خصم على منتج محدد
- **خصم الفاتورة:** خصم عام على الإجمالي
- **خصم بالنسبة:** نسبة مئوية من السعر
- **خصم بالمبلغ:** مبلغ ثابت

## 📊 الإحصائيات والتقارير

### إحصائيات المبيعات
```dart
class SalesStats {
  final int totalSales;           // إجمالي عدد المبيعات
  final double totalRevenue;      // إجمالي الإيرادات
  final double totalProfit;       // إجمالي الأرباح
  final int totalItems;           // إجمالي الأصناف المباعة
  final double averageSale;       // متوسط قيمة البيع
  final Map<String, int> paymentMethodStats; // إحصائيات طرق الدفع
}
```

### التقارير المتاحة
- **مبيعات اليوم:** إجمالي مبيعات اليوم الحالي
- **أفضل المنتجات:** المنتجات الأكثر مبيعاً
- **طرق الدفع:** توزيع طرق الدفع المستخدمة
- **العملاء:** قائمة العملاء وتاريخ مشترياتهم

## 🔒 الأمان والتحقق

### التحقق من البيانات
- **صحة الفاتورة:** التأكد من وجود منتجات وصحة الأسعار
- **توفر المخزون:** التحقق من الكميات المتاحة
- **صحة الدفع:** التأكد من كفاية المبلغ المدفوع
- **تفرد رقم الفاتورة:** منع تكرار أرقام الفواتير

### معالجة الأخطاء
- **رسائل واضحة:** أخطاء مفهومة باللغة العربية
- **تنبيهات بصرية:** ألوان وأيقونات للتنبيه
- **إعادة المحاولة:** خيارات لإعادة العملية
- **تسجيل الأخطاء:** لأغراض التطوير والصيانة

## 🚀 الأداء والتحسينات

### تحسينات الأداء
- **تحميل تدريجي:** للمنتجات والمبيعات
- **ذاكرة تخزين مؤقت:** للبيانات المتكررة
- **حسابات محسنة:** تحديث فوري للإجماليات
- **إدارة ذاكرة فعالة:** تنظيف الموارد غير المستخدمة

### تحسينات تجربة المستخدم
- **استجابة فورية:** للتفاعلات
- **تنبيهات صوتية:** عند إتمام العمليات (قابل للتوسع)
- **اختصارات لوحة المفاتيح:** للاستخدام السريع
- **حفظ تلقائي:** للفواتير المعلقة

## 🎯 حالات الاستخدام

### سيناريو البيع العادي
1. **البحث عن المنتج** أو مسح الباركود
2. **إضافة المنتج** للفاتورة
3. **تعديل الكمية** حسب الحاجة
4. **تطبيق خصم** إذا لزم الأمر
5. **اختيار طريقة الدفع**
6. **إدخال المبلغ المدفوع**
7. **إتمام البيع** وطباعة الفاتورة

### سيناريو البيع بخصم
1. إضافة المنتجات للفاتورة
2. **تطبيق خصم على منتج محدد**
3. **تطبيق خصم عام** على الفاتورة
4. مراجعة الحسابات النهائية
5. إتمام عملية الدفع

### سيناريو البيع للعميل المميز
1. إضافة المنتجات
2. **إدخال معلومات العميل**
3. تطبيق خصم العضوية
4. اختيار طريقة الدفع المفضلة
5. حفظ المعاملة في تاريخ العميل

## 🔮 التطوير المستقبلي

### مميزات مخططة
- [ ] **طباعة الفواتير** مع تصميم احترافي
- [ ] **قارئ الباركود** المدمج
- [ ] **نظام النقاط** للعملاء المميزين
- [ ] **الفواتير الإلكترونية** مع QR Code
- [ ] **تطبيق جوال للعملاء** لتتبع المشتريات
- [ ] **تكامل مع أنظمة الدفع** الإلكترونية
- [ ] **تقارير متقدمة** مع رسوم بيانية
- [ ] **نظام الإشعارات** للمخزون المنخفض

### تحسينات تقنية
- [ ] **مزامنة سحابية** للبيانات
- [ ] **عمل بدون إنترنت** مع مزامنة لاحقة
- [ ] **نسخ احتياطي تلقائي** للبيانات
- [ ] **تشفير البيانات** الحساسة
- [ ] **API للتكامل** مع أنظمة أخرى
- [ ] **تحليلات متقدمة** للمبيعات
- [ ] **ذكاء اصطناعي** لتوقع المبيعات

## 🛠️ كيفية الاستخدام

### للمطورين
```dart
// إضافة SaleProvider إلى التطبيق
MultiProvider(
  providers: [
    ChangeNotifierProvider(create: (_) => SaleProvider()),
  ],
  child: MyApp(),
)

// استخدام SaleProvider في الواجهة
Consumer<SaleProvider>(
  builder: (context, saleProvider, child) {
    return SalesScreen();
  },
)
```

### للمستخدمين
1. **افتح شاشة نقطة البيع**
2. **ابحث عن المنتج** أو امسح الباركود
3. **أضف المنتجات** للفاتورة
4. **راجع الحسابات** والإجماليات
5. **اختر طريقة الدفع**
6. **أدخل المبلغ المدفوع**
7. **أتمم البيع** واطبع الفاتورة

## 📞 الدعم والمساعدة

### الأخطاء الشائعة وحلولها
- **"المنتج غير متوفر":** تحقق من المخزون
- **"رقم الفاتورة مكرر":** سيتم توليد رقم جديد تلقائياً
- **"المبلغ غير كافي":** تأكد من إدخال المبلغ الصحيح
- **"خطأ في الحفظ":** تحقق من اتصال قاعدة البيانات

### نصائح للاستخدام الأمثل
- **استخدم الباركود** للسرعة
- **راجع الفاتورة** قبل الدفع
- **احفظ معلومات العملاء** المتكررين
- **راجع التقارير** بانتظام
- **احتفظ بنسخ احتياطية** من البيانات

---

**تم تطوير هذا النظام ليكون شاملاً ومتكاملاً لجميع احتياجات نقطة البيع الحديثة** 🛒✨