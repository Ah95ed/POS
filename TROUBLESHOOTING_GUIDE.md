# ุฏููู ุงุณุชูุดุงู ุฃุฎุทุงุก ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุฒูู
## POS Inventory System Troubleshooting Guide

## ๐จ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
**"ุนูุฏ ุนูููุฉ ุงูุฏูุน ูููู ูู ุฎุทุฃ ูู ุญูุธ ุงููุงุชูุฑุฉ ุงู ุงูููุชุฌ ุบูุฑ ููุฌูุฏ"**

## ๐ ุงูุชุดุฎูุต ุงููููุฌู

### 1. ูุญุต ุฃููู - ุชุญูู ูู ูุฐู ุงูููุงุท:

#### โ ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌ
```dart
// ูู SaleProvider.completeSale()
final productResult = await _productRepository.getProductByCode(item.productCode);
if (productResult.isError || productResult.data == null) {
  _setError('ุงูููุชุฌ ${item.productName} ุบูุฑ ููุฌูุฏ');
  return false;
}
```

#### โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- **ููุฏ ุงูููุชุฌ**: ูุฌุจ ุฃูุง ูููู ูุงุฑุบุงู ุฃู null
- **ูููุฉ ุงููุงุชูุฑุฉ**: ูุฌุจ ุฃู ุชููู ุฃูุจุฑ ูู 0
- **ุฑูู ุงููุงุชูุฑุฉ**: ูุฌุจ ุฃู ูููู ูุฑูุฏุงู

#### โ ุงูุชุญูู ูู ุงููุฎุฒูู
```dart
if (product.quantity < item.quantity) {
  _setError('ุงููููุฉ ุงููุทููุจุฉ ูู ${item.productName} ุบูุฑ ูุชููุฑุฉ. ุงููุชุงุญ: ${product.quantity}');
  return false;
}
```

### 2. ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง

#### โ ุฎุทุฃ: "ุงูููุชุฌ ุบูุฑ ููุฌูุฏ"

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. **ููุฏ ุงูููุชุฌ ุฎุงุทุฆ ุฃู ููููุฏ**
2. **ุงูููุชุฌ ูุญุฐูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
3. **ูุดููุฉ ูู ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

**ุงูุญููู:**
```dart
// 1. ุชุญูู ูู ููุฏ ุงูููุชุฌ ูุจู ุงูุจุญุซ
if (item.productCode.trim().isEmpty) {
  return StockValidationResult(false, 'ููุฏ ุงูููุชุฌ ูุงุฑุบ ููููุชุฌ: ${item.productName}');
}

// 2. ุงุณุชุฎุฏู ุงูุจุญุซ ุงููุญุณู
final productResult = await _productRepository.getProductByCode(item.productCode.trim());

// 3. ุชุญูู ูู ุฑุณุงูุฉ ุงูุฎุทุฃ
if (productResult.isError) {
  return StockValidationResult(false, 'ุฎุทุฃ ูู ุงูุจุญุซ ุนู ุงูููุชุฌ: ${productResult.error}');
}
```

#### โ ุฎุทุฃ: "ูุดู ูู ุญูุธ ุงููุงุชูุฑุฉ"

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. **ุฑูู ูุงุชูุฑุฉ ููุฑุฑ**
2. **ุจูุงูุงุช ูุงุชูุฑุฉ ุบูุฑ ุตุญูุญุฉ**
3. **ูุดููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

**ุงูุญููู:**
```dart
// 1. ุชุญูู ูู ุตุญุฉ ุงููุงุชูุฑุฉ
if (!sale.isValid) {
  return Result.error('ุจูุงูุงุช ุงููุงุชูุฑุฉ ุบูุฑ ุตุญูุญุฉ');
}

// 2. ุชุญูู ูู ุนุฏู ุชูุฑุงุฑ ุฑูู ุงููุงุชูุฑุฉ
final existingSale = await getSaleByInvoiceNumber(sale.invoiceNumber);
if (existingSale.isSuccess && existingSale.data != null) {
  return Result.error('ุฑูู ุงููุงุชูุฑุฉ ููุฌูุฏ ูุณุจูุงู');
}

// 3. ุงุณุชุฎุฏู ุงููุนุงููุงุช ุงูุขููุฉ
await db.transaction((txn) async {
  // ุงูุนูููุงุช ููุง ุขููุฉ
});
```

#### โ ุฎุทุฃ: "ุงููููุฉ ุงููุทููุจุฉ ุฃูุจุฑ ูู ุงููุชุงุญ"

**ุงูุญููู:**
```dart
// ุชุญูู ูู ุงููููุฉ ูุจู ุงูุจูุน
if (currentQuantity < item.quantity) {
  throw Exception(
    'ุงููููุฉ ุงููุทููุจุฉ ูู $productName (${item.quantity}) ุฃูุจุฑ ูู ุงููุชุงุญ ($currentQuantity)',
  );
}
```

### 3. ุงูุชุญูู ูู ุณูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ๐ง ูุญุต ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```dart
Future<bool> checkDatabaseConnection() async {
  try {
    final db = await POSDatabase.database;
    final result = await db!.rawQuery('SELECT 1');
    return result.isNotEmpty;
  } catch (e) {
    print('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช: $e');
    return false;
  }
}
```

#### ๐ง ูุญุต ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```dart
Future<void> validateDatabaseTables() async {
  final db = await POSDatabase.database;
  
  // ูุญุต ุฌุฏูู ุงูููุชุฌุงุช
  final itemsCount = await db!.rawQuery('SELECT COUNT(*) FROM ${POSDatabase.itemsTable}');
  print('ุนุฏุฏ ุงูููุชุฌุงุช: ${itemsCount.first.values.first}');
  
  // ูุญุต ุฌุฏูู ุงููุจูุนุงุช
  final salesCount = await db.rawQuery('SELECT COUNT(*) FROM ${POSDatabase.salesTable}');
  print('ุนุฏุฏ ุงููุจูุนุงุช: ${salesCount.first.values.first}');
}
```

### 4. ุฎุทูุงุช ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุงูุนูููุฉ

#### ุงููุฑุญูุฉ 1: ูุญุต ุงูููุชุฌ
```dart
// ุชุญูู ูู ูุฌูุฏ ุงูููุชุฌ
final product = await productRepository.getProductByCode('ููุฏ_ุงูููุชุฌ');
if (product.isError) {
  print('โ ุงูููุชุฌ ุบูุฑ ููุฌูุฏ: ${product.error}');
} else {
  print('โ ุงูููุชุฌ ููุฌูุฏ: ${product.data!.name}');
  print('   ุงููููุฉ ุงููุชุงุญุฉ: ${product.data!.quantity}');
}
```

#### ุงููุฑุญูุฉ 2: ูุญุต ุงููุงุชูุฑุฉ
```dart
// ุชุญูู ูู ุตุญุฉ ุจูุงูุงุช ุงููุงุชูุฑุฉ
print('๐งพ ูุญุต ุงููุงุชูุฑุฉ:');
print('   ุฑูู ุงููุงุชูุฑุฉ: ${sale.invoiceNumber}');
print('   ุนุฏุฏ ุงูุนูุงุตุฑ: ${sale.items.length}');
print('   ุงูุฅุฌูุงูู: ${sale.total}');
print('   ุตุญูุญุฉ: ${sale.isValid}');
```

#### ุงููุฑุญูุฉ 3: ูุญุต ุงูุนูููุฉ
```dart
// ุชุชุจุน ุฎุทูุงุช ุญูุธ ุงููุงุชูุฑุฉ
try {
  print('๐ ุจุฏุก ุญูุธ ุงููุงุชูุฑุฉ...');
  
  final result = await saleRepository.saveSale(sale);
  
  if (result.isSuccess) {
    print('โ ุชู ุญูุธ ุงููุงุชูุฑุฉ ุฑูู: ${result.data}');
  } else {
    print('โ ูุดู ูู ุงูุญูุธ: ${result.error}');
  }
} catch (e) {
  print('๐ฅ ุฎุทุฃ ุบูุฑ ูุชููุน: $e');
}
```

### 5. ุงูุญููู ุงูุณุฑูุนุฉ

#### ๐๏ธ ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
```dart
// ูุณุญ ุงูุจูุงูุงุช ุงููุคูุชุฉ
saleProvider.clearCurrentSale();

// ุฅุนุงุฏุฉ ุชุญููู ุงูููุชุฌุงุช
await productProvider.loadProducts();

// ุฅุนุงุฏุฉ ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
await POSDatabase.resetDatabase();
```

#### ๐๏ธ ุฅุตูุงุญ ุงูููุชุฌุงุช ุงูููููุฏุฉ
```dart
// ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ ุฅุฐุง ูุงู ููููุฏุงู
final newProduct = ProductModel(
  name: 'ููุชุฌ ูุญุฏุซ',
  code: 'FIXED001',
  salePrice: 100.0,
  buyPrice: 80.0,
  quantity: 50,
  company: 'ุงูุดุฑูุฉ',
  date: DateTime.now().toString(),
);

await productRepository.addProduct(newProduct);
```

#### ๐๏ธ ุฅุตูุงุญ ุฃุฑูุงู ุงูููุงุชูุฑ
```dart
// ุชูููุฏ ุฑูู ูุงุชูุฑุฉ ุฌุฏูุฏ
final invoiceNumber = 'INV-${DateTime.now().millisecondsSinceEpoch}';
```

### 6. ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุดุงุฆุนุฉ ูุงููุนุงูู

| ุฑุณุงูุฉ ุงูุฎุทุฃ | ุงูุณุจุจ ุงููุญุชูู | ุงูุญู ุงูููุชุฑุญ |
|-------------|---------------|----------------|
| `ุงูููุชุฌ ุบูุฑ ููุฌูุฏ` | ููุฏ ุฎุงุทุฆ ุฃู ููุชุฌ ูุญุฐูู | ุชุญูู ูู ุงูููุฏ ูุฃุนุฏ ุฅุถุงูุฉ ุงูููุชุฌ |
| `ุฑูู ุงููุงุชูุฑุฉ ููุฌูุฏ ูุณุจูุงู` | ุฑูู ูุงุชูุฑุฉ ููุฑุฑ | ุงุณุชุฎุฏู ุฑูู ูุงุชูุฑุฉ ุฌุฏูุฏ |
| `ุงููููุฉ ุบูุฑ ูุชููุฑุฉ` | ูุฎุฒูู ููุฎูุถ | ุฒูุฏ ุงููุฎุฒูู ุฃู ููู ุงููููุฉ |
| `ุจูุงูุงุช ุงููุงุชูุฑุฉ ุบูุฑ ุตุญูุญุฉ` | ุจูุงูุงุช ูุงูุตุฉ | ุชุญูู ูู ุฌููุน ุงูุญููู ุงููุทููุจุฉ |
| `ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช` | ูุดููุฉ ุงุชุตุงู | ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู ุฃู ูุญุต ุงููุงุนุฏุฉ |

### 7. ุฃุฏูุงุช ุงูุชุดุฎูุต ุงููุชูุฏูุฉ

#### ๐ ุณุฌู ุงูุนูููุงุช
```dart
// ุชุณุฌูู ุชูุตููู ููุนูููุงุช
void logSaleOperation(String operation, dynamic data) {
  final timestamp = DateTime.now().toIso8601String();
  print('[$timestamp] $operation: $data');
}

// ุงุณุชุฎุฏุงู ูู ุงูุนูููุงุช
logSaleOperation('ุจุฏุก ุญูุธ ุงููุงุชูุฑุฉ', sale.toMap());
logSaleOperation('ุชุญูู ูู ุงูููุชุฌ', product.toMap());
logSaleOperation('ุชุญุฏูุซ ุงููุฎุฒูู', 'ุชู ุจูุฌุงุญ');
```

#### ๐ฌ ูุญุต ุชูุตููู ููุฃุฎุทุงุก
```dart
Future<void> detailedErrorAnalysis(String error) async {
  print('\n๐ ุชุญููู ููุตู ููุฎุทุฃ:');
  print('ุงูุฎุทุฃ: $error');
  
  // ูุญุต ููุน ุงูุฎุทุฃ
  if (error.contains('ุงูููุชุฌ')) {
    await analyzeProductError();
  } else if (error.contains('ุงููุงุชูุฑุฉ')) {
    await analyzeSaleError();
  } else if (error.contains('ูุงุนุฏุฉ ุงูุจูุงูุงุช')) {
    await analyzeDatabaseError();
  }
}
```

### 8. ุงูููุงูุฉ ูู ุงูุฃุฎุทุงุก

#### โจ ุงูุชุญูู ุงููุณุจู
```dart
// ูุญุต ุดุงูู ูุจู ุงูุจูุน
Future<bool> preSaleValidation() async {
  // 1. ูุญุต ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  // 2. ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌุงุช
  // 3. ูุญุต ุงููุฎุฒูู
  // 4. ุชุญูู ูู ุจูุงูุงุช ุงููุงุชูุฑุฉ
  return true;
}
```

#### ๐ก๏ธ ุญูุงูุฉ ุงูุจูุงูุงุช
```dart
// ูุณุฎ ุงุญุชูุงุทู ูุจู ุงูุนูููุงุช ุงูุญุณุงุณุฉ
await backupDatabase();

// ุงุณุชุฎุฏุงู ุงููุนุงููุงุช ุงูุขููุฉ
await db.transaction((txn) async {
  // ุงูุนูููุงุช ุงููุญููุฉ
});
```

### 9. ุงุฎุชุจุงุฑ ุงููุธุงู

#### ๐งช ุงุฎุชุจุงุฑ ุดุงูู
```bash
# ุชุดุบูู ุงุฎุชุจุงุฑ ุงููุธุงู
dart test_inventory_system.dart
```

#### ๐ ูุงุฆูุฉ ูุญุต ุงููุธุงู
- [ ] ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ
- [ ] ุงูููุชุฌุงุช ููุฌูุฏุฉ ููุญุฏุซุฉ
- [ ] ูุธุงู ุชูููุฏ ุฃุฑูุงู ุงูููุงุชูุฑ ูุนูู
- [ ] ุงูุชุญูู ูู ุงููุฎุฒูู ูุนุงู
- [ ] ุญูุธ ุงูููุงุชูุฑ ูุนูู ุจุดูู ุตุญูุญ
- [ ] ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆู

### ๐ฏ ุงูุฎูุงุตุฉ

ุงููุดููุฉ ุงูุฃุณุงุณูุฉ ุชููู ุนุงุฏุฉ ูู:
1. **ุนุฏู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ** - ุชุญูู ูู ุงูููุฏ ูุงูุจูุงูุงุช
2. **ุฑูู ูุงุชูุฑุฉ ููุฑุฑ** - ุงุณุชุฎุฏู ูุธุงู ุชูููุฏ ุฃูุถู
3. **ูููุฉ ุบูุฑ ูุงููุฉ** - ูุญุต ุงููุฎุฒูู ุฃููุงู
4. **ุจูุงูุงุช ูุงุชูุฑุฉ ุบูุฑ ุตุญูุญุฉ** - ุชุญูู ูู ุฌููุน ุงูุญููู

๐ก **ูุตูุญุฉ**: ุงุณุชุฎุฏู ุฃุฏูุงุช ุงูุชุดุฎูุต ุงููุฑููุฉ ูุชุญุฏูุฏ ุงูุณุจุจ ุงูุฏููู ูุชุทุจูู ุงูุญู ุงูููุงุณุจ.
